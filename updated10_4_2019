---
title: "fhhc report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

title: "FHHC Report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```
Getting the matched pairs for FHHC data need to get rid of the '' on the id
```{r}
library(prettyR)
library(psych)

#setwd("S:/Indiana Research & Evaluation/FHHC Homelessness/Data and QPR")
#base_redcap = read.csv("base_redcap.csv", header = TRUE, na.strings = c(-99, -98, -97, " "))
#month6_redcap = read.csv("month6_redcap.csv", header = TRUE, na.string = c(-99, -98, -97, " "))
#FHHC = read.csv("FHHC.csv", header = TRUE, na.string = c(-99, -98, -97, -1, -4, -5, -7, -9, -2, -6 -8, " "))

#Get matched pairs in FHHC data 

library(lubridate)

dim(FHHC)
FHHC = FHHC[order(FHHC$ConsumerID),]
head(FHHC)
FHHC$ConsumerID = gsub("\\D", "",FHHC$ConsumerID)
FHHC$ConsumerID = as.numeric(FHHC$ConsumerID)
FHHC$InterviewDate = mdy(FHHC$InterviewDate)
dim(FHHC)
## Change date to next quarter
FHHC =subset(FHHC, FHHC$InterviewDate < "2019/10/01")

FHHC_base = subset(FHHC, FHHC$InterviewType_07 == 1)
FHHC_month6 = subset(FHHC, FHHC$InterviewType_07 == 3)
dim(FHHC_month6)
dim(FHHC_base)

FHHC_wide = merge(FHHC_base, FHHC_month6, by = "ConsumerID", all.y = TRUE)
dim(FHHC_wide)
FHHC_wide$ConsumerID == FHHC_month6$ConsumerID
```
Get date from SPARS / NOMS / GPRA and put into redcap base_redcap and redcap month6_redcap Need to get the date from FHHC data for the RedCap 6month data, because we don't have it in the RedCap 6month data set.

```{r}
date_base = data.frame(record_id =  FHHC_base$ConsumerID,  InterviewDate = FHHC_base$InterviewDate)

redcap_date_base = merge(base_redcap, date_base, by = "record_id", all.y = TRUE)
head(redcap_date_base)
dim(base_redcap)

base_redcap = subset(redcap_date_base, InterviewDate < "2019-10-01")
dim(base_redcap)

#CHANGE "id" column name in month6 to "record_id" so you can merge based on that variable (did it manually because was struggling to rename column with name that already existed)



base_redcap$record_id
month6_redcap$record_id



redcap_data = merge(base_redcap, month6_redcap, by = "record_id", all.y = TRUE)
head(redcap_data)
dim(redcap_data)

```

Descriptives
```{r}
library(prettyR)
#1 = male; 2 = female
describe.factor(FHHC_base$Gender)

#RACE
describe.factor(FHHC_base$RaceWhite)
describe.factor(FHHC_base$RaceBlack)
describe.factor(FHHC_base$HispanicLatino)
describe.factor(FHHC_base$RaceAsian)

#12 = 12TH GRADE /HIGH SCHOOL DIPLOMA/ EQUIVALENT (GED)
#13 = VOC/TECH DIPLOMA
#14 = SOME COLLEGE OR UNIVERSITY
#15 = BACHELOR'S DEGREE (BA, BS)
#16 = GRADUATE WORK/GRADUATE DEGREE
describe.factor(FHHC_base$Education)

#4 = Age 16 to 25 years old
#5 = Age 26 to 34 years old
#6 = Age 35 to 44 years old
#7 = Age 45 to 54 years old
#8 = Age 55 to 64 years old
#9= 65 to 74 years old
#10 = Age 75 to 84 years old
#11 = Age 85 to 94 years old
#12 = Age 95 years or older
describe.factor(FHHC_base$Agegroup)
mean(FHHC_base$Agegroup)
#multiply by decimal of mean of age group

35 + .52*(9)



#DIAGNOSES

FHHC_base$DiagnosisOne
describe.factor(FHHC_base$DiagnosisOne)


```

Depression (mean score)

```{r}
#Depression base_redcap
base_redcap_depression = redcap_data[,29:37]
head(base_redcap_depression)
## number of people
dim(base_redcap_depression)
sum(is.na(base_redcap_depression))
base_redcap_depression$PHQ_9_Total = rowSums(base_redcap_depression)
mean(base_redcap_depression$PHQ_9_Total)

## Depression follow-up
month6_redcap_depression = redcap_data[,140:148]
head(month6_redcap_depression)
### number of people
dim(month6_redcap_depression)
sum(is.na(month6_redcap_depression))
month6_redcap_depression$PHQ_9_Total = rowSums(month6_redcap_depression)
mean(month6_redcap_depression$PHQ_9_Total)

#percent change
p_change_phq =  (mean(month6_redcap_depression$PHQ_9_Total)-mean(base_redcap_depression$PHQ_9_Total))/mean(base_redcap_depression$PHQ_9_Total)
p_change_phq
```

ER Visits (count)
```{r}
#ER Visits
FHHC_wide_ER = data.frame(base_redcap_ER = FHHC_wide$TimesER.x, month6_redcap_ER = FHHC_wide$TimesER.y)
FHHC_wide_ER_complete = na.omit(FHHC_wide_ER)
#number of people
dim(FHHC_wide_ER_complete)
head(FHHC_wide_ER)
#base_redcap
sum(FHHC_wide_ER$base_redcap_ER)
#Follow-up
sum(FHHC_wide_ER$month6_redcap_ER)

FHHC_wide_ER_complete

```
Hospitalizations (count)
```{r}
#Nights Hospital MHC
FHHC_wide_hospital = data.frame(base_redcap_Hosp = FHHC_wide$NightsHospitalMHC.x, month6_redcap_Hosp = FHHC_wide$NightsHospitalMHC.y)
FHHC_wide_hospital_complete = na.omit(FHHC_wide_hospital)

# number of people

dim(FHHC_wide_hospital_complete)
head(FHHC_wide_hospital)

#sum base_redcapline

sum(FHHC_wide_hospital$base_redcap_Hosp)

#sum month 6
sum(FHHC_wide_hospital$month6_redcap_Hosp)

```


Anxiety GAD 7 (mean score)
```{r}
#Anxiety base_redcapline

base_redcap_anxiety = redcap_data[,41:47]
head(base_redcap_anxiety)

## number of people
dim(base_redcap_anxiety)
sum(is.na(base_redcap_anxiety))

#base_redcapline mean score
base_redcap_anxiety$Gad_7_Total = rowSums(base_redcap_anxiety)
View(base_redcap_anxiety$Gad_7_Total)
mean(base_redcap_anxiety$Gad_7_Total)

## Anxiety follow-up
month6_redcap_anxiety = redcap_data[,152:158]
head(month6_redcap_anxiety)

### number of people
dim(month6_redcap_anxiety)
sum(is.na(month6_redcap_anxiety))

#follow-up mean score
month6_redcap_anxiety$Gad_7_Total = rowSums(month6_redcap_anxiety)
mean(month6_redcap_anxiety$Gad_7_Total)

## Final results
dim(base_redcap_anxiety)[1]



anx_results = data.frame(dep_mean_base_redcap = mean(base_redcap_anxiety$Gad_7_Total), dep_mean_month6_redcapmean = mean(month6_redcap_anxiety$Gad_7_Total), n = dim(base_redcap_anxiety)[1], pchange = (mean(month6_redcap_anxiety$Gad_7_Total-mean(base_redcap_anxiety$Gad_7_Total))/mean(base_redcap_anxiety$Gad_7_Total)))
anx_results

```
Services related to SMI/COD (count)
```{r}
#sum hospitalizations for mental health and ER visits

#base_redcapline ER and hosp

base_redcap_er_hosp = sum(FHHC_wide_ER$base_redcap_ER, FHHC_wide_hospital$base_redcap_Hosp)

#follow-up ER and hosp

month6_redcap_er_hosp = sum(FHHC_wide_ER$month6_redcap_ER, FHHC_wide_hospital$month6_redcap_Hosp)

p_change_ER_hosp = (month6_redcap_er_hosp- base_redcap_er_hosp)/base_redcap_er_hosp 
p_change_ER_hosp
```
Alcohol (AUDIT mean score)
```{r}
#AUDIT base_redcapline

base_redcap_audit = redcap_data[,5:14]
head(base_redcap_audit)

dim(base_redcap_audit)
base_redcap_audit = na.omit(base_redcap_audit)
sum(is.na(base_redcap_audit))

base_redcap_audit$Audit_Total = rowSums(base_redcap_audit)
mean(base_redcap_audit$Audit_Total)

#AUDIT follow-up
month6_redcap_audit = redcap_data[,116:125]
head(month6_redcap_audit)

dim(month6_redcap_audit)
sum(is.na(month6_redcap_audit))

month6_redcap_audit$Audit_Total = rowSums(month6_redcap_audit)
mean(month6_redcap_audit$Audit_Total)

p_change = (mean(month6_redcap_audit$Audit_Total)-mean(base_redcap_audit$Audit_Total))/mean(base_redcap_audit$Audit_Total)
p_change
```

DAST-10 (Mean Score)
```{r}
#DAST base_redcapline

base_redcap_dast = redcap_data[,17:26]
head(base_redcap_dast)

dim(base_redcap_dast)
base_redcap_dast = na.omit(base_redcap_dast)
sum(is.na(base_redcap_dast))

base_redcap_dast$Dast_Total = rowSums(base_redcap_dast)
mean(base_redcap_dast$Dast_Total)

#Dast follow-up
month6_redcap_dast = redcap_data[,128:137]
head(month6_redcap_dast)


dim(month6_redcap_dast)
month6_redcap_dast = na.omit(month6_redcap_dast)
sum(is.na(month6_redcap_dast))



month6_redcap_dast$Dast_Total = rowSums(month6_redcap_dast)
mean(month6_redcap_dast$Dast_Total)

p_change = (mean(month6_redcap_dast$Dast_Total)-mean(base_redcap_dast$Dast_Total))/mean(base_redcap_dast$Dast_Total)
p_change
```
Benefits enrollment (redcap) "Increase enrollment in health insurance, Medicaid, VA, SSI/SSDI, other benefit programs by 80% for clients
in need of/eligible for these benefits by 9/29/2023."
```{r}

#benefit at base, benefit at month 6, then percent change from base to month 6

#MEDICAID OR MEDICARE

#BASELINE

base_medicaid = redcap_data$medicaid_or_medicare.x
base_medicaid = na.omit(base_medicaid)
sum_base_med = sum(base_medicaid)

#MONTH6

month6_medicaid = redcap_data$medicaid_or_medicare.y
month6_medicaid = na.omit(month6_medicaid)
sum_month6_med = sum(month6_medicaid)

p_change_med = (sum_month6_med - sum_base_med)/sum_base_med

medicaid_or_medicare = data.frame(base = sum_base_med, month6 = sum_month6_med, percentchange = p_change_med)

medicaid_or_medicare


#HIP

#BASELINE

base_hip = redcap_data$healthy_indiana_plan_hip.x
base_hip = na.omit(base_hip)
sum_base_hip = sum(base_hip)


#MONTH6
month6_hip = redcap_data$healthy_indiana_plan_hip.y
month6_hip = na.omit(month6_hip)
sum_month6_hip = sum(month6_hip)

p_change_hip = (sum_month6_hip - sum_base_hip)/sum_base_hip

hip = data.frame(base = sum_base_hip, month6 = sum_month6_hip, percentchange = p_change_hip)

hip

#SSI or SSDI

#BASELINE

base_ssi = redcap_data$ssi_or_ssdi.x
base_ssi = na.omit(base_ssi)
sum_base_ssi = sum(base_ssi)

#MONTH 6
month6_ssi = redcap_data$ssi_or_ssdi.y
month6_ssi = na.omit(month6_ssi)
sum_month6_ssi = sum(month6_ssi)


p_change_ssi = (sum_month6_ssi - sum_base_ssi)/sum_base_ssi

ssi_or_ssdi = data.frame(base = sum_base_ssi, month6 = sum_month6_ssi, percentchange = p_change_ssi)

ssi_or_ssdi


#HUD

#BASELINE

base_hud = redcap_data$hud_or_section_8.x
base_hud = na.omit(base_hud)
sum_base_hud = sum(base_hud)

#MONTH6

month6_hud = redcap_data$hud_or_section_8.y
month6_hud = na.omit(month6_hud)
sum_month6_hud = sum(month6_hud)

p_change_hud = (sum_month6_hud - sum_base_hud)/sum_base_hud

hud = data.frame(base = sum_base_hud, month6 = sum_month6_hud, percentchange = p_change_hud)

hud


#SNAP

#BASE

base_snap = redcap_data$snap_food_stamps.x
base_snap = na.omit(base_snap)
sum_base_snap = sum(base_snap)

#MONTH6
month6_snap = redcap_data$snap_food_stamps.y
month6_snap = na.omit(month6_snap)
sum_month6_snap = sum(month6_snap)

p_change_snap = (sum_month6_snap - sum_base_snap)/sum_base_snap

snap = data.frame(base = sum_base_snap, month6 = sum_month6_snap, percentchange = p_change_snap)

snap


#PERCENT CHANGE OF ALL BENEFITS

benefits_percent_change = data.frame(medicaid_medicare = p_change_med, hip = p_change_hip, ssi_ssdi = p_change_ssi, hud = p_change_hud, snap = p_change_snap)

benefits_percent_change

```




BARC mean score (increase in recovery capital) (not all in base_redcapline completed this measure) STILL COLLECTING DATA FOR THIS
```{r}
#Barc base_redcapline
base_redcap_barc = base_redcap[,86:95]
base_redcap_barc = na.omit(base_redcap_barc)
head(base_redcap_barc)

## number of people
dim(base_redcap_barc)
sum(is.na(base_redcap_barc))

#base_redcapline mean score
base_redcap_barc$Barc_Total = rowSums(base_redcap_barc)
mean(base_redcap_barc$Barc_Total)

## Barc follow-up
month6_redcap_barc = month6_redcap[,81:90]
head(month6_redcap_barc)

### number of people
dim(month6_redcap_barc)
sum(is.na(month6_redcap_barc))

#follow-up mean score
month6_redcap_barc$Barc_Total = rowSums(month6_redcap_barc)
mean(month6_redcap_barc$Barc_Total)
```
PLC-C mean score decrease (lesser trauma symptoms) (if we want to use this, or we can delete this code)

```{r}
#plc base_redcap


base_redcap_plc = redcap_data[,50:66]
head(base_redcap_plc)

## number of people
dim(base_redcap_plc)
sum(is.na(base_redcap_plc))

#base_redcapline mean score
base_redcap_plc$Plc_Total = rowSums(base_redcap_plc)
mean(base_redcap_plc$Plc_Total)

## PLC follow-up
month6_redcap_plc = redcap_data[,161:177]
head(month6_redcap_plc)

### number of people
dim(month6_redcap_plc)
sum(is.na(month6_redcap_plc))

#follow-up mean score
month6_redcap_plc$Plc_Total = rowSums(month6_redcap_plc)
mean(month6_redcap_plc$Plc_Total)

#percent change

p_change_plc = (mean(month6_redcap_plc$Plc_Total)-mean(base_redcap_plc$Plc_Total))/mean(base_redcap_plc$Plc_Total)
p_change_plc

```
