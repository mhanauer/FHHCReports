---
title: "fhhc report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

title: "FHHC Report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```
Getting the matched pairs for FHHC data need to get rid of the '' on the id
```{r}
library(prettyR)
library(psych)

#setwd("S:/Indiana Research & Evaluation/FHHC Homelessness/Data and QPR")
#base_redcap = read.csv("base_redcap.csv", header = TRUE, na.strings = c(-99, -98, -97, " "))
#month6_redcap = read.csv("month6_redcap.csv", header = TRUE, na.string = c(-99, -98, -97, " "))
#FHHC = read.csv("FHHC.csv", header = TRUE, na.string = c(-99, -98, -97, -1, -4, -5, -7, -9, -2, -6 -8, " "))

#Get matched pairs in FHHC data 

library(lubridate)

dim(FHHC)
FHHC = FHHC[order(FHHC$ConsumerID),]
head(FHHC)
FHHC$ConsumerID = gsub("\\D", "",FHHC$ConsumerID)
FHHC$ConsumerID = as.numeric(FHHC$ConsumerID)
FHHC$InterviewDate = mdy(FHHC$InterviewDate)
dim(FHHC)
## Change date to next quarter
FHHC =subset(FHHC, FHHC$InterviewDate < "2019/10/01")
head(FHHC)
FHHC_base = subset(FHHC, FHHC$InterviewType_07 == 1)
FHHC_month6 = subset(FHHC, FHHC$InterviewType_07 == 3)
dim(FHHC_month6)
dim(FHHC_base)

FHHC_wide = merge(FHHC_base, FHHC_month6, by = "ConsumerID", all.y = TRUE)
dim(FHHC_wide)
FHHC_wide$ConsumerID == FHHC_month6$ConsumerID
```
Get date from SPARS / NOMS / GPRA and put into redcap base_redcap and redcap month6_redcap Need to get the date from FHHC data for the RedCap 6month data, because we don't have it in the RedCap 6month data set.

```{r}
date_base = data.frame(record_id =  FHHC_base$ConsumerID,  InterviewDate = FHHC_base$InterviewDate)

redcap_date_base = merge(base_redcap, date_base, by = "record_id", all.y = TRUE)
head(redcap_date_base)
dim(base_redcap)

base_redcap = subset(redcap_date_base, InterviewDate < "2019-10-01")
dim(base_redcap)



base_redcap$record_id
month6_redcap$record_id

redcap_data = merge(base_redcap, month6_redcap, by = "record_id", all.y = TRUE)
head(redcap_data)
dim(redcap_data)

```

Descriptives
```{r}
library(prettyR)
#1 = male; 2 = female
describe.factor(FHHC_base$Gender)

#RACE
describe.factor(FHHC_base$RaceWhite)
describe.factor(FHHC_base$RaceBlack)
describe.factor(FHHC_base$HispanicLatino)
describe.factor(FHHC_base$RaceAsian)

#12 = 12TH GRADE /HIGH SCHOOL DIPLOMA/ EQUIVALENT (GED)
#13 = VOC/TECH DIPLOMA
#14 = SOME COLLEGE OR UNIVERSITY
#15 = BACHELOR'S DEGREE (BA, BS)
#16 = GRADUATE WORK/GRADUATE DEGREE
describe.factor(FHHC_base$Education)

#4 = Age 16 to 25 years old
#5 = Age 26 to 34 years old
#6 = Age 35 to 44 years old
#7 = Age 45 to 54 years old
#8 = Age 55 to 64 years old
#9= 65 to 74 years old
#10 = Age 75 to 84 years old
#11 = Age 85 to 94 years old
#12 = Age 95 years or older
describe.factor(FHHC_base$Agegroup)
mean(FHHC_base$Agegroup)
#multiply by decimal of mean of age group

44-((44-35)*.52)


```

Depression (mean score)

```{r}
#Depression base_redcap
base_redcap_depression = redcap_data[,29:37]
head(base_redcap_depression)
## number of people
dim(base_redcap_depression)
sum(is.na(base_redcap_depression))
base_redcap_depression$PHQ_9_Total = rowSums(base_redcap_depression)
mean(base_redcap_depression$PHQ_9_Total)

## Depression follow-up
month6_redcap_depression = redcap_data[,140:148]
head(month6_redcap_depression)
### number of people
dim(month6_redcap_depression)
sum(is.na(month6_redcap_depression))
month6_redcap_depression$PHQ_9_Total = rowSums(month6_redcap_depression)
mean(month6_redcap_depression$PHQ_9_Total)

#percent change
p_change_phq =  (mean(month6_redcap_depression$PHQ_9_Total)-mean(base_redcap_depression$PHQ_9_Total))/mean(base_redcap_depression$PHQ_9_Total)
p_change_phq
```

ER Visits (count)
```{r}
#ER Visits
FHHC_wide_ER = data.frame(base_redcap_ER = FHHC_wide$TimesER.x, month6_redcap_ER = FHHC_wide$TimesER.y)
FHHC_wide_ER_complete = na.omit(FHHC_wide_ER)
#number of people
dim(FHHC_wide_ER_complete)
head(FHHC_wide_ER)
#base_redcap
sum(FHHC_wide_ER$base_redcap_ER)
#Follow-up
sum(FHHC_wide_ER$month6_redcap_ER)

```
Hospitalizations (count)
```{r}
#Nights Hospital MHC
FHHC_wide_hospital = data.frame(base_redcap_Hosp = FHHC_wide$NightsHospitalMHC.x, month6_redcap_Hosp = FHHC_wide$NightsHospitalMHC.y)
FHHC_wide_hospital_complete = na.omit(FHHC_wide_hospital)

# number of people

dim(FHHC_wide_hospital_complete)
head(FHHC_wide_hospital)

#sum base_redcapline

sum(FHHC_wide_hospital$base_redcap_Hosp)

#sum month 6
sum(FHHC_wide_hospital$month6_redcap_Hosp)

```


Anxiety GAD 7 (mean score)
```{r}
#Anxiety base_redcapline

base_redcap_anxiety = redcap_data[,41:47]
head(base_redcap_anxiety)

## number of people
dim(base_redcap_anxiety)
sum(is.na(base_redcap_anxiety))

#base_redcapline mean score
base_redcap_anxiety$Gad_7_Total = rowSums(base_redcap_anxiety)
View(base_redcap_anxiety$Gad_7_Total)
mean(base_redcap_anxiety$Gad_7_Total)

## Anxiety follow-up
month6_redcap_anxiety = redcap_data[,152:158]
head(month6_redcap_anxiety)

### number of people
dim(month6_redcap_anxiety)
sum(is.na(month6_redcap_anxiety))

#follow-up mean score
month6_redcap_anxiety$Gad_7_Total = rowSums(month6_redcap_anxiety)

## Final results
dim(base_redcap_anxiety)[1]



anx_results = data.frame(dep_mean_base_redcap = mean(base_redcap_anxiety$Gad_7_Total), dep_mean_month6_redcapmean = mean(month6_redcap_anxiety$Gad_7_Total), n = dim(base_redcap_anxiety)[1], pchange = (mean(month6_redcap_anxiety$Gad_7_Total-mean(base_redcap_anxiety$Gad_7_Total))/mean(base_redcap_anxiety$Gad_7_Total)))
anx_results

```
Services related to SMI/COD (count)
```{r}
#sum hospitalizations for mental health and ER visits

#base_redcapline ER and hosp

base_redcap_er_hosp = sum(FHHC_wide_ER$base_redcap_ER, FHHC_wide_hospital$base_redcap_Hosp)

#follow-up ER and hosp

month6_redcap_er_hosp = sum(FHHC_wide_ER$month6_redcap_ER, FHHC_wide_hospital$month6_redcap_Hosp)

p_change_ER_hosp = (month6_redcap_er_hosp- base_redcap_er_hosp)/base_redcap_er_hosp 
p_change_ER_hosp
```
Alcohol (AUDIT mean score)
```{r}
#AUDIT base_redcapline

base_redcap_audit = redcap_data[,3:12]
head(base_redcap_audit)

dim(base_redcap_audit)
base_redcap_audit = na.omit(base_redcap_audit)
sum(is.na(base_redcap_audit))

base_redcap_audit$Audit_Total = rowSums(base_redcap_audit)
mean(base_redcap_audit$Audit_Total)

#AUDIT follow-up
month6_redcap_audit = redcap_data[,114:123]
head(month6_redcap_audit)

dim(month6_redcap_audit)
sum(is.na(month6_redcap_audit))

month6_redcap_audit$Audit_Total = rowSums(month6_redcap_audit)
mean(month6_redcap_audit$Audit_Total)

p_change = (mean(month6_redcap_audit$Audit_Total)-mean(base_redcap_audit$Audit_Total))/mean(base_redcap_audit$Audit_Total)
p_change
```

DAST-10 (Mean Score)
```{r}
#DAST base_redcapline

base_redcap_dast = redcap_data[,15:24]
head(base_redcap_dast)

dim(base_redcap_dast)
base_redcap_dast = na.omit(base_redcap_dast)
sum(is.na(base_redcap_dast))

base_redcap_dast$Dast_Total = rowSums(base_redcap_dast)
mean(base_redcap_dast$Dast_Total)

#Dast follow-up
month6_redcap_dast = redcap_data[,126:135]
head(month6_redcap_dast)

dim(month6_redcap_dast)
sum(is.na(month6_redcap_dast))

month6_redcap_dast$Dast_Total = rowSums(month6_redcap_dast)
mean(month6_redcap_dast$Dast_Total)

p_change = (mean(month6_redcap_dast$Dast_Total)-mean(base_redcap_dast$Dast_Total))/mean(base_redcap_dast$Dast_Total)
p_change
```
Benefits enrollment (redcap)
```{r}

```




BARC mean score (increase in recovery capital) (not all in base_redcapline completed this measure)
```{r}
#Barc base_redcapline
base_redcap_barc = base_redcap[,86:95]
base_redcap_barc = na.omit(base_redcap_barc)
head(base_redcap_barc)

## number of people
dim(base_redcap_barc)
sum(is.na(base_redcap_barc))

#base_redcapline mean score
base_redcap_barc$Barc_Total = rowSums(base_redcap_barc)
mean(base_redcap_barc$Barc_Total)

## Barc follow-up
month6_redcap_barc = month6_redcap[,81:90]
head(month6_redcap_barc)

### number of people
dim(month6_redcap_barc)
sum(is.na(month6_redcap_barc))

#follow-up mean score
month6_redcap_barc$Barc_Total = rowSums(month6_redcap_barc)
mean(month6_redcap_barc$Barc_Total)
```
PLC-C mean score decrease (lesser trauma symptoms) (if we want to use this, or we can delete this code)

```{r}
#plc base_redcap

base_redcap_plc = redcap_data[,48:64]
head(base_redcap_plc)

## number of people
dim(base_redcap_plc)
sum(is.na(base_redcap_plc))

#base_redcapline mean score
base_redcap_plc$Plc_Total = rowSums(base_redcap_plc)
mean(base_redcap_plc$Plc_Total)

## PLC follow-up
month6_redcap_plc = redcap_data[,159:175]
head(month6_redcap_plc)

### number of people
dim(month6_redcap_plc)
sum(is.na(month6_redcap_plc))

#follow-up mean score
month6_redcap_plc$Plc_Total = rowSums(month6_redcap_plc)
mean(month6_redcap_plc$Plc_Total)

#percent change

p_change_plc = (mean(month6_redcap_plc$Plc_Total)-mean(base_redcap_plc$Plc_Total))/mean(base_redcap_plc$Plc_Total)
p_change_plc

```


